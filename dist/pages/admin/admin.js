(wx.webpackJsonp=wx.webpackJsonp||[]).push([[28],{"149":function(e,t,n){e.exports=n.p+"pages/admin/admin.wxml"},"231":function(e,t,n){"use strict";n.r(t);n(232);var a=n(86);for(var o in a)"default"!==o&&function(e){n.d(t,e,function(){return a[e]})}(o)},"232":function(e,t,n){"use strict";n(149)},"233":function(e,t,n){},"30":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0});var I=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function sliceIterator(e,t){var n=[],a=!0,o=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){o=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(o)throw r}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o,r,w=n(0),i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(w),s=n(150);function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}n(233);var c=(function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Admin,w.Component),a(Admin,[{"key":"_constructor","value":function _constructor(){(function get(e,t,n){null===e&&(e=Function.prototype);var a=Object.getOwnPropertyDescriptor(e,t);if(void 0===a){var o=Object.getPrototypeOf(e);return null===o?void 0:get(o,t,n)}if("value"in a)return a.value;var r=a.get;return void 0!==r?r.call(n):void 0})(Admin.prototype.__proto__||Object.getPrototypeOf(Admin.prototype),"_constructor",this).call(this),this.state={"currentTab":0,"orderLists":[],"cancelReasonLists":[],"pageNo":1,"pageSize":5,"hasNextPage":!0,"reasonModal":!1,"cancelReasonId":"","showRefresh":!1,"nowItem":{}},this.$$refs=new i.default.RefsArray}},{"key":"componentDidShow","value":function componentDidShow(){this.reloadData()}},{"key":"onReachBottom","value":function onReachBottom(){this.getLists()}},{"key":"onPullDownRefresh","value":function onPullDownRefresh(){var e=this;this.setState({"pageNo":1,"pageSize":5,"orderLists":[],"hasNextPage":!0},function(){i.default.showNavigationBarLoading(),e.reloadData()})}},{"key":"_createData","value":function _createData(e,t,n){var r=this;this.__state=e||this.state||{},this.__props=t||this.props||{};var i=this.$prefix,a=(0,w.genCompid)(i+"$compid__83"),o=I(a,2),s=o[0],c=o[1],u=(0,w.genCompid)(i+"$compid__84"),l=I(u,2),d=l[0],f=l[1],p=(0,w.genCompid)(i+"$compid__85"),h=I(p,2),m=h[0],g=h[1],_=[];this.__state.cancelReasonLists.forEach(function(e){if("Y"===e.isValid){var t={"label":e.reasonName,"value":e.id};_.push(t)}});var y=(0,w.internal_inline_style)({"height":"100vh"}),v=this.__state.orderLists.map(function(e,t){e={"$original":(0,w.internal_get_original)(e)};var n=r._createFootBtnData(i+"gfzzzzzzzz"+t)(e.$original),a="ggzzz"+t;r.anonymousFunc0Map[a]=function(){return r.makePhoneCall(e.$original.userPhone)};var o="ghzzz"+t;return r.anonymousFunc1Map[o]=function(){return r.makePhoneCall(e.$original.serviceUserPhone)},{"$loopState__temp2":n,"_$indexKey":a,"_$indexKey2":o,"$original":e.$original}});return w.propsManager.set({"current":this.__state.currentTab,"index":0},c,s),w.propsManager.set({"isOpened":this.__state.reasonModal},f,d),w.propsManager.set({"options":_,"value":this.__state.cancelReasonId,"onClick":this.handleRadioChange},g,m),Object.assign(this.__state,{"anonymousState__temp3":y,"loopArray57":v,"$compid__83":c,"$compid__84":f,"$compid__85":g}),this.__state}},{"key":"_createFootBtnData","value":function _createFootBtnData(){return function(e){return{"orderType":e.orderStateName,"orderId":e.orderId,"orderItem":e}}}},{"key":"anonymousFunc0","value":function anonymousFunc0(e){for(var t,n=arguments.length,a=Array(1<n?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];return this.anonymousFunc0Map[e]&&(t=this.anonymousFunc0Map)[e].apply(t,a)}},{"key":"anonymousFunc1","value":function anonymousFunc1(e){for(var t,n=arguments.length,a=Array(1<n?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];return this.anonymousFunc1Map[e]&&(t=this.anonymousFunc1Map)[e].apply(t,a)}}]),r=o=Admin,o.$$events=["anonymousFunc0","anonymousFunc1","handleCancelModal","handleConfirmModal","handleCancelModal","dispatchOrder","closeOrder","conflict","cancelAppeal"],o.$$componentPath="pages/admin/admin",r);function Admin(){var e,t,r;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Admin);for(var n=arguments.length,a=Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=r=_possibleConstructorReturn(this,(e=Admin.__proto__||Object.getPrototypeOf(Admin)).call.apply(e,[this].concat(a)))).$usedState=["anonymousState__temp3","loopArray57","$compid__83","$compid__84","$compid__85","currentTab","orderLists","cancelReasonLists","pageNo","pageSize","hasNextPage","reasonModal","cancelReasonId","showRefresh","nowItem"],r.config={"navigationBarTitleText":"工单处理","navigationStyle":"default","enablePullDownRefresh":!0},r.reloadData=function(){r.setState({"pageNo":1,"pageSize":5,"hasNextPage":!0,"orderLists":[],"reasonModal":!1,"nowItem":{}},function(){r.getLists(),r.getCancelLists()})},r.getCancelLists=function(){(0,s.cancelLists)().then(function(e){r.setState({"cancelReasonLists":e.data.data})})},r.dispatchOrder=function(e){var t=e.target.dataset.id,n=null;r.state.orderLists.forEach(function(e){e.orderId===t&&(n=e)}),i.default.navigateTo({"url":"/pages/admin/staffs?orderId="+n.orderId+"&stationName="+n.stationName+"&type="+n.type})},r.conflict=function(e){var t=e.target.dataset.id,a=null;r.state.orderLists.forEach(function(e){e.orderId===t&&(a=e)}),i.default.showModal({"title":"确认要驳回订单吗？","success":function success(e){if(e.confirm){var t=i.default.getStorageSync("masterInfo"),n={"appealId":a.appealId,"userId":t.masterId,"username":t.masterName,"departmentName":a.stationName};(0,s.conflictAppeal)(n).then(function(e){0===e.data.code?i.default.showToast({"title":"驳回成功","icon":"none"}).then(function(){return setTimeout(function(){r.setState({"pageNo":1,"pageSize":5,"hasNextPage":!0,"orderLists":[]},function(){r.getLists()})})}):i.default.showToast({"title":"驳回失败"+e.data.msg,"icon":"none"})})}}})},r.closeOrder=function(e){var a=null,t=e.target.dataset.id;r.state.orderLists.forEach(function(e){e.orderId===t&&(a=e)}),i.default.showModal({"title":"确认要关闭工单吗？","success":function success(e){if(e.confirm){var t=i.default.getStorageSync("masterInfo"),n={"appealId":a.appealId,"userId":t.masterId,"username":t.masterName,"departmentName":a.stationName};(0,s.closeAppeal)(n).then(function(e){0===e.data.code?i.default.showToast({"title":"操作成功","icon":"none"}).then(function(){return setTimeout(function(){r.reloadData()},1e3)}):i.default.showToast({"title":"操作失败","icon":"none"})})}}})},r.getLists=function(){i.default.showLoading({"title":"加载中"});var e=r.state,t=e.pageNo,n=e.pageSize;if(e.hasNextPage){var a={"pageNo":t,"pageSize":n,"stationId":i.default.getStorageSync("masterInfo").repairStationId};(0,s.lists)(a).then(function(e){if(i.default.hideNavigationBarLoading(),i.default.hideLoading(),i.default.stopPullDownRefresh(),0===e.data.code){var t=e.data.data;r.setState(function(e){return{"hasNextPage":t.hasNextPage,"pageNo":t.hasNextPage?t.nextPage:t.pageNo,"orderLists":e.orderLists.concat(t.list)}})}})}else i.default.showToast({"title":"没有更多了","icon":"none"})},r.handleRadioChange=function(e){r.setState({"cancelReasonId":e})},r.handleCancelModal=function(e){var t=e.target.dataset.id,n=null;r.state.orderLists.forEach(function(e){e.orderId===t&&(n=e)}),r.setState(function(e){return{"reasonModal":!e.reasonModal,"cancelReasonId":"","nowItem":n}})},r.cancelAppeal=function(e){var t=e.target.dataset.id,a=null;r.state.orderLists.forEach(function(e){e.orderId===t&&(a=e)}),i.default.showModal({"title":"确定要取消工单吗？","success":function success(e){if(e.confirm){var t=i.default.getStorageSync("masterInfo"),n={"appealId":a.appealId,"userId":t.masterId,"username":t.masterName,"departmentName":a.stationName};(0,s.cancelConf)(n).then(function(e){0===e.data.code?i.default.showToast({"title":"操作成功","icon":"none"}).then(function(){setTimeout(function(){r.reloadData()},1e3)}):i.default.showToast({"title":"操作失败","icon":"none"})})}}})},r.handleConfirmModal=function(){var e=r.state,t=e.nowItem,n=e.cancelReasonId,a=i.default.getStorageSync("masterInfo");console.log("stationName----",t.stationName);var o={"orderId":t.orderId,"reasonId":n,"userId":a.masterId,"username":a.masterName,"departmentName":t.stationName};(0,s.cancel)(o).then(function(e){0===e.data.code?i.default.showToast({"title":"订单取消成功","icon":"none"}).then(function(){return setTimeout(function(){return r.reloadData()},1e3)}):i.default.showToast({"title":"订单取消失败："+e.data.msg,"icon":"none"})})},r.makePhoneCall=function(e){i.default.makePhoneCall({"phoneNumber":e,"fail":function fail(){return!1}})},r.anonymousFunc0Map={},r.anonymousFunc1Map={},r.customComponents=["AtTabsPane","AtModal","AtModalHeader","AtModalContent","AtRadio","AtModalAction"],_possibleConstructorReturn(r,t)}t.default=c,Component(n(0).default.createComponent(c,!0))},"86":function(e,t,n){"use strict";n.r(t);var a=n(30),o=n.n(a);for(var r in a)"default"!==r&&function(e){n.d(t,e,function(){return a[e]})}(r);t.default=o.a}},[[231,0,1,2]]]);