(wx.webpackJsonp=wx.webpackJsonp||[]).push([[30],{"147":function(t,e,n){t.exports=n.p+"pages/custom-order/detail.wxml"},"228":function(t,e,n){"use strict";n.r(e);n(229);var o=n(84);for(var a in o)"default"!==a&&function(t){n.d(e,t,function(){return o[t]})}(a)},"229":function(t,e,n){"use strict";n(147)},"230":function(t,e,n){},"29":function(t,e,u){"use strict";Object.defineProperty(e,"__esModule",{"value":!0});var k=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function sliceIterator(t,e){var n=[],o=!0,a=!1,i=void 0;try{for(var r,c=t[Symbol.iterator]();!(o=(r=c.next()).done)&&(n.push(r.value),!e||n.length!==e);o=!0);}catch(t){a=!0,i=t}finally{try{!o&&c.return&&c.return()}finally{if(a)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},n=function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t};function defineProperties(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o,a,L=u(0),c=function _interopRequireDefault(t){return t&&t.__esModule?t:{"default":t}}(L),s=u(146),m=u(68),l=u(7);function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}u(230);var i=(function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{"constructor":{"value":t,"enumerable":!1,"writable":!0,"configurable":!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(Lists,L.Component),n(Lists,[{"key":"_constructor","value":function _constructor(){(function get(t,e,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,e);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:get(a,e,n)}if("value"in o)return o.value;var i=o.get;return void 0!==i?i.call(n):void 0})(Lists.prototype.__proto__||Object.getPrototypeOf(Lists.prototype),"_constructor",this).call(this),this.state={"id":"","cancelReasonId":"","orderDetail":{},"cancelReasonLists":[],"reasonModal":!1,"baseInfo":{"orderState":"ASSIGNED"},"repairOrderOfferPlanVoList":[],"dispatchInfo":null,"repairOrderAmountVos":[],"waitPay":0,"payed":0,"commentInfo":{},"currentComment":0,"commentNowModal":!1,"commentOptions":[],"commentActiveTags":[],"commentDetail":[],"commentDetailModal":!1},this.$$refs=new c.default.RefsArray}},{"key":"componentWillMount","value":function componentWillMount(){var t=this,e=this.$router.params.id;this.setState({"id":e},function(){t.getOrderDetail(),t.getCancelReason(),t.getCommentLists()})}},{"key":"_createData","value":function _createData(t,e,n){var s=this;this.__state=t||this.state||{},this.__props=e||this.props||{};var u=this.$prefix,o=(0,L.genCompid)(u+"$compid__102"),a=k(o,2),i=a[0],r=a[1],c=(0,L.genCompid)(u+"$compid__103"),m=k(c,2),l=m[0],d=m[1],f=(0,L.genCompid)(u+"$compid__104"),p=k(f,2),_=p[0],y=p[1],h=(0,L.genCompid)(u+"$compid__105"),g=k(h,2),v=g[0],C=g[1],O=(0,L.genCompid)(u+"$compid__106"),$=k(O,2),b=$[0],A=$[1],S=(0,L.genCompid)(u+"$compid__107"),F=k(S,2),M=F[0],z=F[1],I=[];this.__state.cancelReasonLists.forEach(function(t){if("Y"===t.isValid){var e={"label":t.reasonName,"value":t.id};I.push(e)}});var P=this._createFootData(u+"hbzzzzzzzz")();this.anonymousFunc0=function(){return s.call(s.__state.dispatchInfo.masterPhone)};var w=this.__state.commentOptions.map(function(t){return{"title":t.name}}),T=this.__state.commentDetail.map(function(t){return{"title":t.name}});this.anonymousFunc1=function(){return console.log("111")},this.anonymousFunc2=function(){return s.setState({"commentDetailModal":!1})};var R=this.__state.commentOptions.map(function(t,c){var e=(t={"$original":(0,L.internal_get_original)(t)}).$original.children.map(function(t,e){t={"$original":(0,L.internal_get_original)(t)};var n=-1<s.__state.commentActiveTags.indexOf(t.$original.id),o=(0,L.genCompid)(u+"hczzzzzzzz"+c+"-"+e,!0),a=k(o,2),i=a[0],r=a[1];return L.propsManager.set({"className":"tag-item","name":t.$original.id,"active":n,"type":"primary","onClick":s.clickCommentTag},r,i),{"$loopState__temp4":n,"$compid__98":r,"$original":t.$original}}),n=(0,L.genCompid)(u+"hdzzzzzzzz"+c,!0),o=k(n,2),a=o[0],i=o[1];return L.propsManager.set({"className":"comment-pane","current":s.__state.currentComment,"index":c},i,a),{"$anonymousCallee__8":e,"$compid__99":i,"$original":t.$original}}),D=this.__state.commentDetail.map(function(t,r){var e=(t={"$original":(0,L.internal_get_original)(t)}).$original.children.map(function(t,e){t={"$original":(0,L.internal_get_original)(t)};var n=(0,L.genCompid)(u+"hezzzzzzzz"+r+"-"+e,!0),o=k(n,2),a=o[0],i=o[1];return L.propsManager.set({"className":"tag-item","name":t.$original.id,"active":!0,"type":"primary"},i,a),{"$compid__100":i,"$original":t.$original}}),n=(0,L.genCompid)(u+"hfzzzzzzzz"+r,!0),o=k(n,2),a=o[0],i=o[1];return L.propsManager.set({"className":"comment-pane","current":s.__state.currentComment,"index":r},i,a),{"$anonymousCallee__9":e,"$compid__101":i,"$original":t.$original}});return L.propsManager.set({"isOpened":this.__state.reasonModal},r,i),L.propsManager.set({"options":I,"value":this.__state.cancelReasonId,"onClick":this.handleRadioChange},d,l),L.propsManager.set({"className":"comment-modal","isOpened":this.__state.commentNowModal},y,_),L.propsManager.set({"animated":!1,"current":this.__state.currentComment,"tabList":w,"onClick":this.handleCommentTab.bind(this)},C,v),L.propsManager.set({"isOpened":this.__state.commentDetailModal},A,b),L.propsManager.set({"animated":!1,"current":0,"tabList":T,"onClick":this.anonymousFunc1},z,M),Object.assign(this.__state,{"anonymousState__temp2":w,"anonymousState__temp5":T,"loopArray68":R,"loopArray69":D,"$compid__102":r,"$compid__103":d,"$compid__104":y,"$compid__105":C,"$compid__106":A,"$compid__107":z,"anonymousState__temp":P}),this.__state}},{"key":"_createFootData","value":function _createFootData(){var s=this;return function(){var t,e,n=s.state,o=n.dispatchInfo,a=n.waitPay,i=n.payed,r=n.baseInfo,c=n.commentInfo;if("STAY_PAY"===r.orderState)s.anonymousFunc3=function(){return s.call(r.stationPhone)},t=u(85),s.anonymousFunc4=function(){return s.call(o.masterPhone)},e=u(148);else if("VYING"!==r.orderState)if("ASSIGNED"===r.orderState)s.anonymousFunc5=function(){return s.call(r.stationPhone)};else if("WAIT_DOOR"===r.orderState)s.anonymousFunc6=function(){return s.call(o.masterPhone)};else{if("CANCEL"===r.orderState)return null;"FINISH"===r.orderState&&(s.anonymousFunc7=function(){return s.setState({"commentNowModal":!0})},s.anonymousFunc8=function(){return s.setState({"commentDetailModal":!0})})}return{"_$anonymousState__temp":t,"_$anonymousState__temp2":e,"waitPay":a,"baseInfo":r,"payed":i,"commentInfo":c}}}},{"key":"anonymousFunc0","value":function anonymousFunc0(){}},{"key":"anonymousFunc1","value":function anonymousFunc1(){}},{"key":"anonymousFunc2","value":function anonymousFunc2(){}},{"key":"anonymousFunc3","value":function anonymousFunc3(){}},{"key":"anonymousFunc4","value":function anonymousFunc4(){}},{"key":"anonymousFunc5","value":function anonymousFunc5(){}},{"key":"anonymousFunc6","value":function anonymousFunc6(){}},{"key":"anonymousFunc7","value":function anonymousFunc7(){}},{"key":"anonymousFunc8","value":function anonymousFunc8(){}}]),a=o=Lists,o.$$events=["anonymousFunc0","handleCancelModal","handleConfirmModal","cancelComment","confirmComment","anonymousFunc2","anonymousFunc3","anonymousFunc4","startPay","handleCancelModal","anonymousFunc5","anonymousFunc6","anonymousFunc7","anonymousFunc8"],o.$$componentPath="pages/custom-order/detail",a);function Lists(){var t,e,i;!function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Lists);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=i=_possibleConstructorReturn(this,(t=Lists.__proto__||Object.getPrototypeOf(Lists)).call.apply(t,[this].concat(o)))).$usedState=["anonymousState__temp2","anonymousState__temp5","loopArray68","loopArray69","$compid__102","$compid__103","$compid__104","$compid__105","$compid__106","$compid__107","anonymousState__temp","id","cancelReasonId","orderDetail","cancelReasonLists","reasonModal","baseInfo","repairOrderOfferPlanVoList","dispatchInfo","repairOrderAmountVos","waitPay","payed","commentInfo","currentComment","commentNowModal","commentOptions","commentActiveTags","commentDetail","commentDetailModal"],i.config={"navigationBarTitleText":"报修详情","navigationStyle":"default"},i.getCommentLists=function(){(0,s.getCommentOption)().then(function(t){0===t.data.code&&i.setState({"commentOptions":t.data.data})})},i.getOrderDetail=function(){var t=i.state.id;(0,s.getDetail)(t).then(function(t){if(0===t.data.code){var e=t.data.data,n=0,o=0;e.repairOrderAmountVos.forEach(function(t){"STAY_PAY_AMOUNT"===t.type&&(n=t.amount),"ALREADY_PAY_AMOUNT"===t.type&&(o=t.amount)}),i.setState({"orderDetail":t.data.data,"baseInfo":e.baseInfo,"repairOrderOfferPlanVoList":e.repairOrderOfferPlanVoList,"dispatchInfo":e.dispatchInfo,"repairOrderAmountVos":e.repairOrderAmountVos,"waitPay":n,"payed":o,"commentInfo":e.commentInfo,"commentDetail":e.commentInfo.comment?[e.commentInfo.comment.comment]:[]})}})},i.startPay=function(){var t={"orderIds":[i.state.baseInfo.id],"payBusinessType":"W_REPAIR_ORDER","payCode":"WX_XCX"};(0,m.getWxPay)(t).then(function(t){if(0===t.data.code){var e=t.data.data;console.log("支付信息",e),c.default.requestPayment(r({"success":function success(){i.orderSuccess()},"fail":function fail(){console.log("接口调用失败"),console.log("支付失败")}},e))}else c.default.showToast({"title":t.data.msg,"icon":"none"})})},i.orderSuccess=function(){c.default.showModal({"content":"订单支付成功，可在【我的】-【报修订单】中查看","confirmText":"查看订单","cancelText":"回到首页","success":function success(t){t.confirm?c.default.reLaunch({"url":"/pages/mine/mine"}):c.default.reLaunch({"url":"/pages/index/index"})}})},i.getCancelReason=function(){(0,s.cancelReason)().then(function(t){if(0===t.data.code){var e=t.data.data;i.setState({"cancelReasonLists":e})}})},i.handleRadioChange=function(t){i.setState({"cancelReasonId":t})},i.handleCancelModal=function(){i.setState(function(t){return{"reasonModal":!t.reasonModal,"cancelReasonId":""}})},i.handleConfirmModal=function(){var t={"repairOrderId":i.state.id,"cancelReasonId":i.state.cancelReasonId};(0,s.cancelOrder)(t).then(function(t){0===t.data.code?(c.default.showToast({"title":"订单取消成功","icon":"none"}),c.default.navigateBack({"delta":-1})):c.default.showToast({"title":"订单取消失败："+t.data.msg,"icon":"none"})})},i.call=function(t){c.default.makePhoneCall({"phoneNumber":t})},i.clickCommentTag=function(t){var e=JSON.parse(JSON.stringify(i.state.commentActiveTags));e.indexOf(t.name)<=-1?e.push(t.name):e.splice(e.indexOf(t.name),1),i.setState({"commentActiveTags":e})},i.handleCommentTab=function(t){i.setState({"commentActiveTags":[],"currentComment":t})},i.cancelComment=function(){i.setState({"commentNowModal":!1,"commentActiveTags":[]})},i.confirmComment=function(){var t=i.state.id,e=i.state.currentComment,n=(0,l.simpleClone)(i.state.commentOptions[e]),o=i.state.commentActiveTags;n.children=n.children.filter(function(t){return-1<o.indexOf(t.id)});var a=n;(0,s.submitComment)(t,a).then(function(t){0===t.data.code&&(c.default.showToast({"title":"评价成功","icon":"none"}),setTimeout(function(){c.default.navigateBack({"delta":-1})},1500))})},i.customComponents=["AtModal","AtModalHeader","AtModalContent","AtRadio","AtModalAction","AtTabs","AtTabsPane","AtTag"],_possibleConstructorReturn(i,e)}e.default=i,Component(u(0).default.createComponent(i,!0))},"84":function(t,e,n){"use strict";n.r(e);var o=n(29),a=n.n(o);for(var i in o)"default"!==i&&function(t){n.d(e,t,function(){return o[t]})}(i);e.default=a.a}},[[228,0,1,2]]]);