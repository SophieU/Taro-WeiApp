(wx.webpackJsonp=wx.webpackJsonp||[]).push([[32],{"151":function(t,e,n){t.exports=n.p+"pages/custom-order/detail.wxml"},"232":function(t,e,n){"use strict";n.r(e);n(233);var o=n(87);for(var a in o)"default"!==a&&function(t){n.d(e,t,function(){return o[t]})}(a)},"233":function(t,e,n){"use strict";n(151)},"234":function(t,e,n){},"30":function(t,e,u){"use strict";Object.defineProperty(e,"__esModule",{"value":!0});var j=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function sliceIterator(t,e){var n=[],o=!0,a=!1,i=void 0;try{for(var r,s=t[Symbol.iterator]();!(o=(r=s.next()).done)&&(n.push(r.value),!e||n.length!==e);o=!0);}catch(t){a=!0,i=t}finally{try{!o&&s.return&&s.return()}finally{if(a)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},n=function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t};function defineProperties(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o,a,E=u(0),s=function _interopRequireDefault(t){return t&&t.__esModule?t:{"default":t}}(E),c=u(150),m=u(71),l=u(7);function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}u(234);var i=(function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{"constructor":{"value":t,"enumerable":!1,"writable":!0,"configurable":!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(Lists,E.Component),n(Lists,[{"key":"_constructor","value":function _constructor(){(function get(t,e,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,e);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:get(a,e,n)}if("value"in o)return o.value;var i=o.get;return void 0!==i?i.call(n):void 0})(Lists.prototype.__proto__||Object.getPrototypeOf(Lists.prototype),"_constructor",this).call(this),this.state={"id":"","cancelReasonId":"","orderDetail":{},"cancelReasonLists":[],"reasonModal":!1,"baseInfo":{"orderState":"ASSIGNED"},"repairOrderOfferPlanVoList":[],"dispatchInfo":null,"repairOrderAmountVos":[],"waitPay":0,"payed":0,"commentInfo":{},"currentComment":0,"commentNowModal":!1,"commentOptions":[],"commentActiveTags":[],"commentDetail":[],"commentDetailModal":!1},this.$$refs=new s.default.RefsArray}},{"key":"componentWillMount","value":function componentWillMount(){var t=this,e=this.$router.params.id;this.setState({"id":e},function(){t.getOrderDetail(),t.getCancelReason(),t.getCommentLists()})}},{"key":"_createData","value":function _createData(t,e,n){var c=this;this.__state=t||this.state||{},this.__props=e||this.props||{};var u=this.$prefix,o=(0,E.genCompid)(u+"$compid__113"),a=j(o,2),i=a[0],r=a[1],s=(0,E.genCompid)(u+"$compid__114"),m=j(s,2),l=m[0],d=m[1],f=(0,E.genCompid)(u+"$compid__115"),p=j(f,2),_=p[0],y=p[1],h=(0,E.genCompid)(u+"$compid__116"),g=j(h,2),v=g[0],C=g[1],O=(0,E.genCompid)(u+"$compid__117"),$=j(O,2),b=$[0],S=$[1],A=(0,E.genCompid)(u+"$compid__118"),M=j(A,2),F=M[0],z=M[1],I=(0,E.genCompid)(u+"$compid__119"),w=j(I,2),P=w[0],T=w[1],L=[];this.__state.cancelReasonLists.forEach(function(t){if("Y"===t.isValid){var e={"label":t.reasonName,"value":t.id};L.push(e)}});var D=this._createFootData(u+"hbzzzzzzzz")();this.anonymousFunc0=function(){return c.call(c.__state.dispatchInfo.masterPhone)};var R=this.__state.commentOptions.map(function(t){return{"title":t.name}}),k=this.__state.commentDetail.map(function(t){return{"title":t.name}});this.anonymousFunc1=function(){return console.log("111")},this.anonymousFunc2=function(){return c.setState({"commentDetailModal":!1})};var N=this.__state.commentOptions.map(function(t,s){var e=(t={"$original":(0,E.internal_get_original)(t)}).$original.children.map(function(t,e){t={"$original":(0,E.internal_get_original)(t)};var n=-1<c.__state.commentActiveTags.indexOf(t.$original.id),o=(0,E.genCompid)(u+"hczzzzzzzz"+s+"-"+e,!0),a=j(o,2),i=a[0],r=a[1];return E.propsManager.set({"className":"tag-item","name":t.$original.id,"active":n,"type":"primary","onClick":c.clickCommentTag},r,i),{"$loopState__temp4":n,"$compid__109":r,"$original":t.$original}}),n=(0,E.genCompid)(u+"hdzzzzzzzz"+s,!0),o=j(n,2),a=o[0],i=o[1];return E.propsManager.set({"className":"comment-pane","current":c.__state.currentComment,"index":s},i,a),{"$anonymousCallee__8":e,"$compid__110":i,"$original":t.$original}}),x=this.__state.commentDetail.map(function(t,r){var e=(t={"$original":(0,E.internal_get_original)(t)}).$original.children.map(function(t,e){t={"$original":(0,E.internal_get_original)(t)};var n=(0,E.genCompid)(u+"hezzzzzzzz"+r+"-"+e,!0),o=j(n,2),a=o[0],i=o[1];return E.propsManager.set({"className":"tag-item","name":t.$original.id,"active":!0,"type":"primary"},i,a),{"$compid__111":i,"$original":t.$original}}),n=(0,E.genCompid)(u+"hfzzzzzzzz"+r,!0),o=j(n,2),a=o[0],i=o[1];return E.propsManager.set({"className":"comment-pane","current":c.__state.currentComment,"index":r},i,a),{"$anonymousCallee__9":e,"$compid__112":i,"$original":t.$original}});return E.propsManager.set({"state":this.__state.baseInfo.orderStateName},r,i),E.propsManager.set({"isOpened":this.__state.reasonModal},d,l),E.propsManager.set({"options":L,"value":this.__state.cancelReasonId,"onClick":this.handleRadioChange},y,_),E.propsManager.set({"className":"comment-modal","isOpened":this.__state.commentNowModal},C,v),E.propsManager.set({"animated":!1,"current":this.__state.currentComment,"tabList":R,"onClick":this.handleCommentTab.bind(this)},S,b),E.propsManager.set({"isOpened":this.__state.commentDetailModal},z,F),E.propsManager.set({"animated":!1,"current":0,"tabList":k,"onClick":this.anonymousFunc1},T,P),Object.assign(this.__state,{"anonymousState__temp2":R,"anonymousState__temp5":k,"loopArray70":N,"loopArray71":x,"$compid__113":r,"$compid__114":d,"$compid__115":y,"$compid__116":C,"$compid__117":S,"$compid__118":z,"$compid__119":T,"anonymousState__temp":D}),this.__state}},{"key":"_createFootData","value":function _createFootData(){var c=this;return function(){var t,e,n=c.state,o=n.dispatchInfo,a=n.waitPay,i=n.payed,r=n.baseInfo,s=n.commentInfo;if("STAY_PAY"===r.orderState)c.anonymousFunc3=function(){return c.call(r.stationPhone)},t=u(88),c.anonymousFunc4=function(){return c.call(o.masterPhone)},e=u(152);else if("VYING"!==r.orderState)if("ASSIGNED"===r.orderState)c.anonymousFunc5=function(){return c.call(r.stationPhone)};else if("WAIT_DOOR"===r.orderState)c.anonymousFunc6=function(){return c.call(o.masterPhone)};else{if("CANCEL"===r.orderState)return null;"FINISH"===r.orderState&&(c.anonymousFunc7=function(){return c.setState({"commentNowModal":!0})},c.anonymousFunc8=function(){return c.setState({"commentDetailModal":!0})})}return{"_$anonymousState__temp":t,"_$anonymousState__temp2":e,"waitPay":a,"baseInfo":r,"payed":i,"commentInfo":s}}}},{"key":"anonymousFunc0","value":function anonymousFunc0(){}},{"key":"anonymousFunc1","value":function anonymousFunc1(){}},{"key":"anonymousFunc2","value":function anonymousFunc2(){}},{"key":"anonymousFunc3","value":function anonymousFunc3(){}},{"key":"anonymousFunc4","value":function anonymousFunc4(){}},{"key":"anonymousFunc5","value":function anonymousFunc5(){}},{"key":"anonymousFunc6","value":function anonymousFunc6(){}},{"key":"anonymousFunc7","value":function anonymousFunc7(){}},{"key":"anonymousFunc8","value":function anonymousFunc8(){}}]),a=o=Lists,o.$$events=["anonymousFunc0","handleCancelModal","handleConfirmModal","cancelComment","confirmComment","anonymousFunc2","anonymousFunc3","anonymousFunc4","startPay","handleCancelModal","anonymousFunc5","anonymousFunc6","anonymousFunc7","anonymousFunc8"],o.$$componentPath="pages/custom-order/detail",a);function Lists(){var t,e,i;!function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Lists);for(var n=arguments.length,o=Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=i=_possibleConstructorReturn(this,(t=Lists.__proto__||Object.getPrototypeOf(Lists)).call.apply(t,[this].concat(o)))).$usedState=["anonymousState__temp2","anonymousState__temp5","loopArray70","loopArray71","$compid__113","$compid__114","$compid__115","$compid__116","$compid__117","$compid__118","$compid__119","anonymousState__temp","id","cancelReasonId","orderDetail","cancelReasonLists","reasonModal","baseInfo","repairOrderOfferPlanVoList","dispatchInfo","repairOrderAmountVos","waitPay","payed","commentInfo","currentComment","commentNowModal","commentOptions","commentActiveTags","commentDetail","commentDetailModal"],i.config={"navigationBarTitleText":"报修详情","navigationStyle":"default"},i.getCommentLists=function(){(0,c.getCommentOption)().then(function(t){0===t.data.code&&i.setState({"commentOptions":t.data.data})})},i.getOrderDetail=function(){var t=i.state.id;s.default.showLoading({"title":"加载中"}),(0,c.getDetail)(t).then(function(t){if(s.default.hideLoading(),0===t.data.code){var e=t.data.data,n=0,o=0;e.repairOrderAmountVos.forEach(function(t){"STAY_PAY_AMOUNT"===t.type&&(n=t.amount),"ALREADY_PAY_AMOUNT"===t.type&&(o=t.amount)}),i.setState({"orderDetail":t.data.data,"baseInfo":e.baseInfo,"repairOrderOfferPlanVoList":e.repairOrderOfferPlanVoList,"dispatchInfo":e.dispatchInfo,"repairOrderAmountVos":e.repairOrderAmountVos,"waitPay":n,"payed":o,"commentInfo":e.commentInfo,"commentDetail":e.commentInfo.comment?[e.commentInfo.comment.comment]:[]})}})},i.startPay=function(){var t={"orderIds":[i.state.baseInfo.id],"payBusinessType":"W_REPAIR_ORDER","payCode":"WX_XCX"};(0,m.getWxPay)(t).then(function(t){if(0===t.data.code){var e=t.data.data;console.log("支付信息",e),s.default.requestPayment(r({"success":function success(){i.orderSuccess()},"fail":function fail(){console.log("接口调用失败"),console.log("支付失败")}},e))}else s.default.showToast({"title":t.data.msg,"icon":"none"})})},i.orderSuccess=function(){s.default.showModal({"content":"订单支付成功，可在【我的】-【报修订单】中查看","confirmText":"查看订单","cancelText":"回到首页","success":function success(t){t.confirm?s.default.reLaunch({"url":"/pages/mine/mine"}):s.default.reLaunch({"url":"/pages/index/index"})}})},i.getCancelReason=function(){(0,c.cancelReason)().then(function(t){if(0===t.data.code){var e=t.data.data;i.setState({"cancelReasonLists":e})}})},i.handleRadioChange=function(t){i.setState({"cancelReasonId":t})},i.handleCancelModal=function(){i.setState(function(t){return{"reasonModal":!t.reasonModal,"cancelReasonId":""}})},i.handleConfirmModal=function(){var t={"repairOrderId":i.state.id,"cancelReasonId":i.state.cancelReasonId};s.default.showLoading({"title":"系统处理中"}),(0,c.cancelOrder)(t).then(function(t){s.default.hideLoading(),0===t.data.code?s.default.showToast({"title":"订单取消成功","icon":"none"}).then(function(t){i.handleCancelModal(),i.getOrderDetail()}):s.default.showToast({"title":"订单取消失败："+t.data.msg,"icon":"none"})})},i.call=function(t){s.default.makePhoneCall({"phoneNumber":t})},i.clickCommentTag=function(t){var e=JSON.parse(JSON.stringify(i.state.commentActiveTags));e.indexOf(t.name)<=-1?e.push(t.name):e.splice(e.indexOf(t.name),1),i.setState({"commentActiveTags":e})},i.handleCommentTab=function(t){i.setState({"commentActiveTags":[],"currentComment":t})},i.cancelComment=function(){i.setState({"commentNowModal":!1,"commentActiveTags":[]})},i.confirmComment=function(){var t=i.state.id,e=i.state.currentComment,n=(0,l.simpleClone)(i.state.commentOptions[e]),o=i.state.commentActiveTags;n.children=n.children.filter(function(t){return-1<o.indexOf(t.id)});var a=n;s.default.showLoading({"title":"提交中"}),(0,c.submitComment)(t,a).then(function(t){s.default.hideLoading(),0===t.data.code&&(s.default.showToast({"title":"评价成功","icon":"none"}),i.setState({"commentNowModal":!1,"currentComment":0,"commentActiveTags":[]},function(){i.getOrderDetail()}))})},i.customComponents=["StateText","AtModal","AtModalHeader","AtModalContent","AtRadio","AtModalAction","AtTabs","AtTabsPane","AtTag"],_possibleConstructorReturn(i,e)}e.default=i,Component(u(0).default.createComponent(i,!0))},"87":function(t,e,n){"use strict";n.r(e);var o=n(30),a=n.n(o);for(var i in o)"default"!==i&&function(t){n.d(e,t,function(){return o[t]})}(i);e.default=a.a}},[[232,0,1,2]]]);