(wx.webpackJsonp=wx.webpackJsonp||[]).push([[47],{"153":function(t,e,n){t.exports=n.p+"pages/staff-order/detail.wxml"},"239":function(t,e,n){"use strict";n.r(e);n(240);var o=n(90);for(var a in o)"default"!==a&&function(t){n.d(e,t,function(){return o[t]})}(a)},"240":function(t,e,n){"use strict";n(153)},"33":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{"value":!0});var P=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function sliceIterator(t,e){var n=[],o=!0,a=!1,r=void 0;try{for(var i,s=t[Symbol.iterator]();!(o=(i=s.next()).done)&&(n.push(i.value),!e||n.length!==e);o=!0);}catch(t){a=!0,r=t}finally{try{!o&&s.return&&s.return()}finally{if(a)throw r}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t};function defineProperties(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var a,r,S=n(0),i=function _interopRequireDefault(t){return t&&t.__esModule?t:{"default":t}}(S),s=n(10);function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}n(89);var u=(function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{"constructor":{"value":t,"enumerable":!1,"writable":!0,"configurable":!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(Lists,S.Component),o(Lists,[{"key":"_constructor","value":function _constructor(){(function get(t,e,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,e);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:get(a,e,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0})(Lists.prototype.__proto__||Object.getPrototypeOf(Lists.prototype),"_constructor",this).call(this),this.state={"id":"","cancelReasonId":"","orderDetail":{},"reasonModal":!1,"baseInfo":{"orderState":"ASSIGNED"},"repairOrderOfferPlanVoList":[],"dispatchInfo":null,"repairOrderAmountVos":[],"totalAmount":0,"showAction":!1,"repairOrderDispatchId":"","timer":null,"countDown":120,"waitPayToast":!1,"commentInfo":null},this.$$refs=new i.default.RefsArray}},{"key":"componentDidShow","value":function componentDidShow(){this.loadPage()}},{"key":"componentWillUnmount","value":function componentWillUnmount(){clearInterval(this.state.timer)}},{"key":"loadPage","value":function loadPage(){var t=this,e=this.$router.params.id;this.setState({"id":e,"counteDown":120,"waitPayToast":!1,"timer":null},function(){t.getOrderDetail()})}},{"key":"_createFootData","value":function _createFootData(){var a=this;return function(){var t=a.state,e=t.baseInfo,n=t.repairOrderAmountVos,o=0;return n.forEach(function(t){"ALL_AMOUNT"===t.type&&(o=t.amount)}),"待上门"===e.orderStateName||"待付款"===e.orderStateName||e.orderStateName,{"baseInfo":e,"total":o}}}},{"key":"_createData","value":function _createData(t,e,n){var o=this;this.__state=t||this.state||{},this.__props=e||this.props||{};var a=this.$prefix,r=(0,S.genCompid)(a+"$compid__86"),i=P(r,2),s=i[0],u=i[1],c=(0,S.genCompid)(a+"$compid__87"),d=P(c,2),l=d[0],f=d[1],p=(0,S.genCompid)(a+"$compid__88"),m=P(p,2),_=m[0],h=m[1],y=(0,S.genCompid)(a+"$compid__89"),v=P(y,2),O=v[0],g=v[1],w=this.__state.baseInfo.orderStateName,b=this._createFootData(a+"gizzzzzzzz")();this.anonymousFunc0=function(){return o.call(o.__state.dispatchInfo.masterPhone)},this.anonymousFunc1=function(){return o.call(o.__state.baseInfo.userPhone)},this.anonymousFunc2=function(){return o.waitPay("user")},this.anonymousFunc3=function(){return o.waitPay("qr-code")};var I="等待支付中,剩余"+this.__state.countDown+"S";return S.propsManager.set({"isOpened":this.__state.showAction,"cancelText":"取消","title":"请选择收款方式"},u,s),S.propsManager.set({"onClick":this.anonymousFunc2},f,l),S.propsManager.set({"onClick":this.anonymousFunc3},h,_),S.propsManager.set({"status":"loading","duration":0,"isOpened":this.__state.waitPayToast,"text":I,"icon":"loading-3"},g,O),Object.assign(this.__state,{"anonymousState__temp2":I,"$compid__86":u,"$compid__87":f,"$compid__88":h,"$compid__89":g,"stateText":w,"anonymousState__temp":b}),this.__state}},{"key":"anonymousFunc0","value":function anonymousFunc0(){}},{"key":"anonymousFunc1","value":function anonymousFunc1(){}},{"key":"anonymousFunc2","value":function anonymousFunc2(){}},{"key":"anonymousFunc3","value":function anonymousFunc3(){}}]),r=a=Lists,a.$$events=["appealOrder","resetPrice","sureOrder","anonymousFunc0","anonymousFunc1"],a.$$componentPath="pages/staff-order/detail",r);function Lists(){var t,e,a;!function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Lists);for(var n=arguments.length,o=Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=a=_possibleConstructorReturn(this,(t=Lists.__proto__||Object.getPrototypeOf(Lists)).call.apply(t,[this].concat(o)))).$usedState=["anonymousState__temp2","$compid__86","$compid__87","$compid__88","$compid__89","stateText","anonymousState__temp","id","cancelReasonId","orderDetail","reasonModal","baseInfo","repairOrderOfferPlanVoList","dispatchInfo","repairOrderAmountVos","totalAmount","showAction","repairOrderDispatchId","timer","countDown","waitPayToast","commentInfo"],a.config={"navigationBarTitleText":"报修详情","navigationStyle":"default"},a.getPayResult=function(){(0,s.payResCustom)(a.state.repairOrderDispatchId).then(function(t){0===t.data.code&&(a.setState({"payRes":t.data.data}),"Y"===t.data.data&&i.default.showToast({"title":"收款成功"}).then(function(){return setTimeout(function(){var t=a.state.timer;clearInterval(t),a.loadPage()},1e3)}))})},a.appealOrder=function(){var t=a.state,e=t.id,n=t.baseInfo,o="id="+e+"&orderSn="+n.orderSn+"&orderState="+n.orderStateName+"&repaireType="+n.repairCategoryName;i.default.navigateTo({"url":"/pages/staff-order/refuse?"+o})},a.getOrderDetail=function(){var t=a.state.id;i.default.showLoading({"title":"信息加载中","icon":"none"}),(0,s.orderDetail)(t).then(function(t){if(i.default.hideLoading(),0===t.data.code){var e=t.data.data,n=0;e.repairOrderAmountVos&&e.repairOrderAmountVos.map(function(t){t.type="ALL_AMOUNT",n=t.amount}),a.setState({"orderDetail":t.data.data,"baseInfo":e.baseInfo,"repairOrderDispatchId":e.baseInfo.repairOrderDispatchId,"repairOrderOfferPlanVoList":e.repairOrderOfferPlanVoList,"dispatchInfo":e.dispatchInfo,"repairOrderAmountVos":e.repairOrderAmountVos,"totalAmount":n,"commentInfo":e.commentInfo})}})},a.waitPay=function(e){a.setState({"showAction":!1},function(){if("user"===e)var t=setInterval(function(){a.state.timer||a.setState({"timer":t,"waitPayToast":!0}),a.state.countDown<=0?(clearInterval(a.state.timer),i.default.hideLoading(),a.setState({"countDown":120,"waitPayToast":!1,"timer":null})):a.setState(function(t){t.countDown--}),a.state.countDown%3==0&&a.getPayResult()},1e3);else"qr-code"===e&&i.default.navigateTo({"url":"/pages/staff-order/pay?type=staff&id="+a.state.id})})},a.sureOrder=function(){a.setState({"showAction":!0})},a.resetPrice=function(){var t="id="+a.state.id+"&dispatchId="+a.state.repairOrderDispatchId;i.default.navigateTo({"url":"/pages/staff-order/quote?"+t})},a.call=function(t){i.default.makePhoneCall({"phoneNumber":t})},a.customComponents=["AtActionSheet","AtActionSheetItem","AtToast"],_possibleConstructorReturn(a,e)}e.default=u,Component(n(0).default.createComponent(u,!0))},"90":function(t,e,n){"use strict";n.r(e);var o=n(33),a=n.n(o);for(var r in o)"default"!==r&&function(t){n.d(e,t,function(){return o[t]})}(r);e.default=a.a}},[[239,0,1,2]]]);