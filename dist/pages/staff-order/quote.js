(wx.webpackJsonp=wx.webpackJsonp||[]).push([[53],{"158":function(e,t,n){e.exports=n.p+"pages/staff-order/quote.wxml"},"245":function(e,t,n){"use strict";n.r(t);n(246);var r=n(94);for(var o in r)"default"!==o&&function(e){n.d(t,e,function(){return r[e]})}(o)},"246":function(e,t,n){"use strict";n(158)},"35":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{"value":!0});var r=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o,a,i=n(0),s=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(i),u=n(9);function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{"value":n,"enumerable":!0,"configurable":!0,"writable":!0}):e[t]=n,e}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}n(92);var c=(function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Quote,i.Component),r(Quote,[{"key":"_constructor","value":function _constructor(){(function get(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:get(o,t,n)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(n):void 0})(Quote.prototype.__proto__||Object.getPrototypeOf(Quote.prototype),"_constructor",this).call(this),this.state={"staffPrice":0,"id":"","type":"","doorFee":"","nightFee":"","servicePrice":"","materialsPrice":"","totalAmount":0,"repairOrderOfferPlanVoList":[],"dispatchId":"","finalAmount":0},this.$$refs=new s.default.RefsArray}},{"key":"componentWillMount","value":function componentWillMount(){var e=this,t=this.$router.params,n=t.id,r=t.type,o=t.dispatchId;this.setState({"id":n,"type":r,"dispatchId":o},function(){e.getFee()})}},{"key":"_createData","value":function _createData(e,t,n){var r=this;return this.__state=e||this.state||{},this.__props=t||this.props||{},this.$prefix,this.anonymousFunc0=function(e){return r.handlePriceChange(e,"servicePrice")},this.anonymousFunc1=function(e){return r.handlePriceChange(e,"materialsPrice")},Object.assign(this.__state,{}),this.__state}},{"key":"anonymousFunc0","value":function anonymousFunc0(){}},{"key":"anonymousFunc1","value":function anonymousFunc1(){}}]),a=o=Quote,o.$$events=["filterInput","anonymousFunc0","anonymousFunc1","submitPlan"],o.$$componentPath="pages/staff-order/quote",a);function Quote(){var e,t,i;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Quote);for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return(t=i=_possibleConstructorReturn(this,(e=Quote.__proto__||Object.getPrototypeOf(Quote)).call.apply(e,[this].concat(r)))).$usedState=["staffPrice","id","type","doorFee","nightFee","servicePrice","materialsPrice","totalAmount","repairOrderOfferPlanVoList","dispatchId","finalAmount"],i.config={"navigationBarTitleText":"报价清单","navigationStyle":"default","enablePullDownRefresh":!1},i.getFee=function(){(0,u.orderDetail)(i.state.id).then(function(e){if(0===e.data.code){var t=0,n=e.data.data.repairOrderOfferPlanVoList.filter(function(e){return"MATERIAL_PROJECT"!==e.planType&&"SERVICE_PROJECT"!==e.planType&&("N"===e.isPay?(t+=e.amount,!0):void 0)});i.setState({"repairOrderOfferPlanVoList":n,"totalAmount":t,"finalAmount":t})}})},i.submitPlan=function(){if(i.state.servicePrice||i.state.materialsPrice){s.default.showLoading({"title":"提交中"});var e=[{"planType":"SERVICE_PROJECT","serviceCost":i.state.servicePrice},{"planType":"MATERIAL_PROJECT","serviceCost":i.state.materialsPrice}];(0,u.setPricePlan)(i.state.dispatchId,e).then(function(e){0===e.data.code?s.default.showToast({"title":"报价方案提交成功"}).then(function(){s.default.navigateBack()}):s.default.showToast({"title":e.data.msg,"icon":"none"})})}else s.default.showToast({"title":"请至少填写服务费或材料费中一项","icon":"none"})},i.handlePriceChange=function(e,n){var r=e.detail.value,o=i.state.totalAmount,a=o;i.setState(function(e){var t;return a="materialsPrice"!==n||e.servicePrice?"materialsPrice"===n&&e.servicePrice?o+parseFloat(r||0)+parseFloat(e.servicePrice?e.servicePrice:0):o+parseFloat(r||0)+parseFloat(e.materialsPrice?e.materialsPrice:0):o+parseFloat(r||0),_defineProperty(t={},n,parseFloat(r)),_defineProperty(t,"finalAmount",a),t})},i.filterInput=function(e){var t=e.detail.value;return t.toString().split(".")[1]&&2<=t.toString().split(".")[1].length?parseFloat(t).toFixed(2):-1<t.indexOf(".")&&2<t.split(".").length?"":void 0},i.customComponents=[],_possibleConstructorReturn(i,t)}t.default=c,Component(n(0).default.createComponent(c,!0))},"94":function(e,t,n){"use strict";n.r(t);var r=n(35),o=n.n(r);for(var a in r)"default"!==a&&function(e){n.d(t,e,function(){return r[e]})}(a);t.default=o.a}},[[245,0,1,2]]]);